{% extends 'base.html' %}
{% block content %}
<h2 class="mb-3">{{ stock_id }} {{ stock_name }} 歷史趨勢</h2>

<div class="card p-3 mb-4">
    <canvas id="bengoChart" height="250"></canvas>
</div>

<div class="card p-3">
    <h5 class="mb-3">詳細數據</h5>
    <div class="table-responsive">
        <table class="table table-striped table-hover text-center align-middle">
            <thead class="table-dark">
                <tr>
                    <th>日期</th>
                    <th>收盤價</th>
                    <th>Bengo門檻</th>
                    <th>大戶比例</th>
                    <th>大戶人數</th>
                    <th>備註</th>
                </tr>
            </thead>
            <tbody>
                {% for row in table_data %}
                <tr>
                    <td>{{ row.date|date:"Y/m/d" }}</td>
                    <td class="fw-bold text-primary">{{ row.price }}</td>
                    <td>{{ row.bengo_threshold }}</td>
                    <td class="fw-bold text-danger">{{ row.major_pct }}%</td>
                    <td>{{ row.major_people }}</td>
                    <td class="small text-muted">{{ row.note }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    const ctx = document.getElementById('bengoChart').getContext('2d');
    const myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ dates|safe }},
            datasets: [{
                label: '大戶持股比例 (%)',
                data: {{ major_pcts|safe }},
                borderColor: 'rgb(220, 53, 69)', // 紅色
                backgroundColor: 'rgba(220, 53, 69, 0.1)',
                yAxisID: 'y',
                tension: 0.3,
                fill: true
            }, {
                label: '收盤價',
                data: {{ prices|safe }},
                borderColor: 'rgb(13, 110, 253)', // 藍色
                yAxisID: 'y1',
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            scales: {
                y: { type: 'linear', display: true, position: 'left', title: {display: true, text: '持股比例%'} },
                y1: { type: 'linear', display: true, position: 'right', grid: { drawOnChartArea: false }, title: {display: true, text: '股價'} }
            }
        }
    });
</script>
{% endblock %}